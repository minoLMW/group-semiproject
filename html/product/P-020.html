<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title></title>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">
	<link rel="stylesheet" href="../../assets/css/common-ui.css">
</head>
<body>
	<div class="page">
		<div class="container">
			<header class="header"></header><!-- product-view-top__content product-view-top__content--center -->

			<main class="contents">
				<div class="content">
					<section>
						<article class="product-view-top product-view-top--icecream swiper">
							<div class="product-view-top__container swiper-wrapper"></div>
							<div class="swiper-button-next"></div>
						    <div class="swiper-button-prev"></div>
						</article>
						<div class="product-view__container">
							<article class="product-view-nutrition">
								<div class="product-view-nutrition__container">
									<h3 class="product-view-nutrition__title">영양정보</h3>
									<dl class="product-view-nutrition__content">
										<div class="product-view-nutrition__item">
											<dt class="product-view-nutrition__name">1회 제공량</dt>
											<dd class="product-view-nutrition__text">115</dd>
										</div>
										<div class="product-view-nutrition__item">
											<dt class="product-view-nutrition__name">열량(kcal)</dt>
											<dd class="product-view-nutrition__text">221</dd>
										</div>
										<div class="product-view-nutrition__item">
											<dt class="product-view-nutrition__name">당류(g)</dt>
											<dd class="product-view-nutrition__text">36</dd>
										</div>
										<div class="product-view-nutrition__item">
											<dt class="product-view-nutrition__name">단백질(g)</dt>
											<dd class="product-view-nutrition__text">2</dd>
										</div>
										<div class="product-view-nutrition__item">
											<dt class="product-view-nutrition__name">포화지방(g)</dt>
											<dd class="product-view-nutrition__text">2.7</dd>
										</div>
										<div class="product-view-nutrition__item">
											<dt class="product-view-nutrition__name">나트륨(mg)</dt>
											<dd class="product-view-nutrition__text">32</dd>
										</div>
										<div class="product-view-nutrition__item">
											<dt class="product-view-nutrition__name">알레르기 성분</dt>
											<dd class="product-view-nutrition__text">우유, 대두, 복숭아</dd>
										</div>
									</dl>
								</div>
							</article>
							<article class="product-view-content">
								<div class="product-view-content__container">
									<div class="product-view-content__content">
										<img alt="" src="https://www.baskinrobbins.co.kr/upload/ckeditor/b6b84e71b837272b15a33431d5c5fe79.png" class="product-view-content__image">
									</div>
								</div>
							</article>
						</div>
					</section>
				</div>
			</main>

			<footer class="footer"></footer>
		</div>
	</div>
	<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
	<script src="../../assets/libs/jquery/jquery-3.6.0.min.js"></script>
	<script src="../../assets/js/common-ui.js"></script>
	<script>
		document.addEventListener("DOMContentLoaded", function() {
			const swiperContainer = document.querySelector(".product-view-top__container");
			const contentImage = document.querySelector("img.product-view-content__image");
			const nutritionContainer = document.querySelector(".product-view-nutrition__content");

			let jsonData = [];

			// JSON 파일 로드
			fetch("../../dev/json/baskin_robbins_nutrition_generated.json")
				.then((response) => response.json())
				.then((data) => {
					jsonData = data.response.body.items.item;
					swiperContainer.innerHTML = "";

					jsonData.forEach((item, index) => {
						const slide = document.createElement("div");
						slide.classList.add("product-view-top__content", "product-view-top__content--center", "swiper-slide");
						slide.dataset.index = index;

						slide.innerHTML = `
							<div class="product-view-top__box">
								<div class="product-view-header">
									<div class="product-view-header__container">
										<div class="product-view-header__content">
											<p class="product-view-header__category">ICECREAM</p>
											<h2 class="product-view-header__title">
												<span class="product-view-header__title--en">${item.English_Name}</span>
												<span class="product-view-header__title--ko">${item.ice_name}</span>
											</h2>
											<p class="product-view-header__text">${item.Description}</p>
										</div>
									</div>
								</div>
								<div class="product-view-ingredients">
									<ul class="product-view-ingredients__list">
										${item.Ingredients.slice(0, 2).map(ingredient => `
											<li class="product-view-ingredients__item">
												<img src="${ingredient.Image}" alt="${ingredient.Name}" class="product-view-ingredients__image">
												<span class="product-view-ingredients__name">${ingredient.Name}</span>
											</li>
										`).join("")}
									</ul>
								</div>
								<div class="product-function">
									<div class="product-function__number">
										<input type="text" class="product-function__input" maxlength="2" title="수량" placeholder="00">
										<div class="product-function__counts">
											<button type="button" class="product-function__up" aria-label="숫자 올리기"></button>
											<button type="button" class="product-function__down" aria-label="숫자 내리기"></button>
										</div>
									</div>
									<button type="button" class="product-function__cart">장바구니 담기</button>
									<button type="button" class="product-function__buy">바로구매</button>
								</div>
							</div>
							<div class="product-main-image">
								<div class="product-view-hero product-view-hero--icecream" style="background-color:${item.bg_color}">
									<img src="${item.Image_URL}" alt="${item.ice_name}" class="product-view-hero__image">
								</div>
							</div>
						`;
						swiperContainer.appendChild(slide);
					});

					// Swiper 초기화
					icecreamSwiper();
					updateContentImage(0); // 첫 번째 이미지로 초기화
					updateNutritionInfo(0);
				})
				.catch(() => {
					alert("아이스크림 정보를 불러오는 데 실패했습니다.");
				});

			// Swiper 설정 함수
			function icecreamSwiper() {
				const swiper = new Swiper('.swiper', {
					observer: true,
					observeParents: true,
					observeSlideChildren: true,
					slidesPerView: 2,
					spaceBetween: 30,
					centeredSlides: true,
					navigation: {
						nextEl: '.swiper-button-next',
						prevEl: '.swiper-button-prev',
					},
					breakpoints: {
						768: {
							slidesPerView: 1,
							navigation: false,
						},
						1500: {
							slidesPerView: 2
						}
					},
					on: {
						slideChange: function(swiper) {
							const currentIndex = swiper.activeIndex;
							console.log("현재 인덱스:", currentIndex);
							updateContentImage(currentIndex);
							updateNutritionInfo(currentIndex);
						}
					}
				});
			}

			function updateContentImage(index) {
				const matchedItem = jsonData[index];
				if (matchedItem) {
					contentImage.src = matchedItem.Content_Images ? matchedItem.Content_Images[0] : matchedItem.Image_URL;
					console.log("현재 이미지 변경:", matchedItem.ice_name);
				} else {
					console.error("해당 인덱스를 가진 아이템을 찾을 수 없습니다:", index);
				}
			}

			function updateNutritionInfo(index) {
				const matchedItem = jsonData[index];
				if (matchedItem) {
					nutritionContainer.innerHTML = `
						<div class="product-view-nutrition__item">
							<dt class="product-view-nutrition__name">1회 제공량</dt>
							<dd class="product-view-nutrition__text">${matchedItem.Serving_Size || "N/A"}</dd>
						</div>
						<div class="product-view-nutrition__item">
							<dt class="product-view-nutrition__name">열량(kcal)</dt>
							<dd class="product-view-nutrition__text">${matchedItem.Calories || "N/A"}</dd>
						</div>
						<div class="product-view-nutrition__item">
							<dt class="product-view-nutrition__name">당류(g)</dt>
							<dd class="product-view-nutrition__text">${matchedItem.Sugars || "N/A"}</dd>
						</div>
						<div class="product-view-nutrition__item">
							<dt class="product-view-nutrition__name">단백질(g)</dt>
							<dd class="product-view-nutrition__text">${matchedItem.Protein || "N/A"}</dd>
						</div>
						<div class="product-view-nutrition__item">
							<dt class="product-view-nutrition__name">포화지방(g)</dt>
							<dd class="product-view-nutrition__text">${matchedItem.Saturated_Fat || "N/A"}</dd>
						</div>
						<div class="product-view-nutrition__item">
							<dt class="product-view-nutrition__name">나트륨(mg)</dt>
							<dd class="product-view-nutrition__text">${matchedItem.Sodium || "N/A"}</dd>
						</div>
						<div class="product-view-nutrition__item">
							<dt class="product-view-nutrition__name">알레르기 성분</dt>
							<dd class="product-view-nutrition__text">${matchedItem.Allergens || "N/A"}</dd>
						</div>
					`;
					console.log("현재 영양정보 변경:", matchedItem.ice_name);
				} else {
					console.error("해당 인덱스를 가진 아이템을 찾을 수 없습니다:", index);
				}
			}
		});
	</script>
</body>
</html>